<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Tower Defense</title>
	<link rel="stylesheet" type="text/css" href="main.css">
	<script src="jquery.js"></script>
</head>
<body>
        <h1>XXX 的塔防遊戲</h1>
	<canvas id="game" width="720" height="540" style="top:0;left:0;"></canvas>
        <script language="javascript">
		var click = false;
		var count = 0;
		var mouseX = 0;
		var mouseY = 0;
		var score = 0;
		var money = 100;
		var health = 20;
		var enemy = [];
		var tower = [];
		var missile = [];
		var grapeshot = [];
		var enemyPath = [];
		var map = new Array(18);
		var mapX = 0;
		var mapY = 0;
		var z = [true, true, true, true];
		var choose = 0;
		var ran = 0;
		var map = new Array(18);
		for (var i = 0; i < 18; i++) {
			map[i] = new Array(18);
		}
		while (true) {
			while (true) {
				if (mapY == 0) {
					z[0] = false;
				} else if (map[mapX][mapY - 1] == "unTower" || map[mapX][mapY - 1] == "enemyPath") {
					z[0] = false;
				} else {
					z[0] = true;
				}
				if (mapX == 17) {
					z[1] = false;
				} else if (map[mapX + 1][mapY] == "unTower" || map[mapX + 1][mapY] == "enemyPath") {
					z[1] = false;
				} else {
					z[1] = true;
				}
				if (mapY == 17) {
					z[2] = false;
				} else if (map[mapX][mapY + 1] == "unTower" || map[mapX][mapY + 1] == "enemyPath") {
					z[2] = false;
				} else {
					z[2] = true;
				}
				if (mapX == 0) {
					z[3] = false;
				} else if (map[mapX - 1][mapY] == "unTower" || map[mapX - 1][mapY] == "enemyPath") {
					z[3] = false;
				} else {
					z[3] = true;
				}
				if (z[0] == false && z[1] == false && z[2] == false && z[3] == false) {
					break;
				}
				while (true) {
					ran = Math.floor(Math.random() * 4);
					choose = z[ran];
					if (choose == true) {
						break;
					}
				}
				enemyPath.push({
					x: mapX * 30 + 15,
					y: mapY * 30 + 15,
				})
				if (mapY != 0 && ran != 0 && map[mapX][mapY - 1] != "enemyPath") {
					map[mapX][mapY - 1] = "unTower";
				}
				if (mapX != 17 && ran != 1 && map[mapX + 1][mapY] != "enemyPath") {
					map[mapX + 1][mapY] = "unTower";
				}
				if (mapY != 17 && ran != 2 && map[mapX][mapY + 1] != "enemyPath") {
					map[mapX][mapY + 1] = "unTower";
				}
				if (mapX != 0 && ran != 3 && map[mapX - 1][mapY] != "enemyPath") {
					map[mapX - 1][mapY] = "unTower";
				}
				if (ran == 0) {
					mapY--;
				} else if (ran == 1) {
					mapX++;
				} else if (ran == 2) {
					mapY++;
				} else if (ran == 3) {
					mapX--;
				}
				map[mapX][mapY] = "enemyPath";
			}
			if (enemyPath.length > 144) {
				break;
			} else {
				enemyPath = [];
				mapX = 0;
				mapY = 0;
				map = [];
				map = new Array(18);
				for (var i = 0; i < 18; i++) {
					map[i] = new Array(18);
				}
			}
		}
		enemyPath.push({
			x: mapX * 30 + 15,
			y: mapY * 30 + 15,
		})
		for (var i = 0; i < 18; i++) {
			for (var j = 0; j < 18; j++) {
				if (map[i][j] != "enemyPath") {
					map[i][j] = "unTower";
				}
			}
		}
		map[0][0] = "enemyPath";
		$(document).mousemove(function(event) {
			mouseX = event.pageX - 7;
			mouseY = event.pageY - 7;
		});
		function draw() {
			drawMap();
			drawMenu();
			enemyMove();
			drawTower();
			count++;
		}
		function drawMap() {
			var canvas = document.getElementById("game");
			if (canvas.getContext) {
				var ctx = canvas.getContext("2d");
				ctx.clearRect(0, 0, 720, 540);
				ctx.fillStyle = "rgb(0, 0, 0)";
				ctx.fillRect(0, 0, 720, 540);
				for (var i = 0; i < 18; i++) {
					for (var j = 0; j < 18; j++) {
						if (map[i][j] == "unTower" || map[i][j] == "tower") {
							ctx.fillStyle = "rgb(40, 40, 40)";
							ctx.fillRect(i * 30 + 1, j * 30 + 1, 28, 28);
						}
					}
				}
				ctx.fillStyle = "rgb(0, 0, 0)";
				if (mouseX < 540 && mouseY < 540 && mouseX >= 0 && mouseY >= 0 && (Math.floor(mouseX / 30) != 0 || Math.floor(mouseY / 30) != 0)) {
					if (map[Math.floor(mouseX / 30)][Math.floor(mouseY / 30)] == "unTower") {
						ctx.fillStyle = "rgb(15, 15, 15)";
						ctx.fillRect(Math.floor(mouseX / 30) * 30 + 1, Math.floor(mouseY / 30) * 30 + 1, 28, 28);
					}
				}
				for (var i = 0; i <= 30; i++) {
					ctx.fillStyle = "rgb(0, " + (i * 6) + ", " + (i * 6) + ")";
					ctx.fillRect(mapX * 30 + (i / 2), mapY * 30 + (i / 2), Math.abs(i - 30), Math.abs(i - 30));
				}
			}
		}
		function drawTower() {
			var canvas = document.getElementById("game");
			if (canvas.getContext) {
				var ctx = canvas.getContext("2d");
				if (click == "a") {
					drawTowerA(true, mouseX, mouseY, 1);
				} else if (click == "b") {
					drawTowerB(true, mouseX, mouseY, 1);
				} else if (click == "c") {
					drawTowerC(true, mouseX, mouseY, 1);
				} else if (click == "d") {
					drawTowerD(mouseX, mouseY, 0);
				} else if (click == "e") {
					drawTowerE(true, mouseX, mouseY, 0);
				} else if (click == "f") {
					drawTowerF(true, mouseX, mouseY, 0, 1);
				} else if (click == "g") {
					drawTowerG(mouseX, mouseY);
				} else if (click == "h") {
					drawTowerH(mouseX, mouseY, 1);
				}
				for (var i = 0; i < tower.length; i++) {
					tower[i].action();
					if (tower[i].s == "a") {
						if (Math.sqrt(((tower[i].x - mouseX) * (tower[i].x - mouseX)) + ((tower[i].y - mouseY) * (tower[i].y - mouseY))) < 15 && click == false) {
							drawTowerA(true, tower[i].x, tower[i].y, tower[i].l);
						} else {
							drawTowerA(false, tower[i].x, tower[i].y, tower[i].l);
						}
					}
					if (tower[i].s == "b") {
						if (Math.sqrt(((tower[i].x - mouseX) * (tower[i].x - mouseX)) + ((tower[i].y - mouseY) * (tower[i].y - mouseY))) < 15 && click == false) {
							drawTowerB(true, tower[i].x, tower[i].y, tower[i].l);
						} else {
							drawTowerB(false, tower[i].x, tower[i].y, tower[i].l);
						}
					}
					if (tower[i].s == "c") {
						if (Math.sqrt(((tower[i].x - mouseX) * (tower[i].x - mouseX)) + ((tower[i].y - mouseY) * (tower[i].y - mouseY))) < 15 && click == false) {
							drawTowerC(true, tower[i].x, tower[i].y, tower[i].l);
						} else {
							drawTowerC(false, tower[i].x, tower[i].y, tower[i].l);
						}
					}
					if (tower[i].s == "d") {
						drawTowerD(tower[i].x, tower[i].y, tower[i].b);
					}
					if (tower[i].s == "e") {
						if (Math.sqrt(((tower[i].x - mouseX) * (tower[i].x - mouseX)) + ((tower[i].y - mouseY) * (tower[i].y - mouseY))) < 15 && click == false) {
							drawTowerE(true, tower[i].x, tower[i].y, tower[i].b.n);
						} else {
							drawTowerE(false, tower[i].x, tower[i].y, tower[i].b.n);
						}
					}
					if (tower[i].s == "f") {
						if (Math.sqrt(((tower[i].x - mouseX) * (tower[i].x - mouseX)) + ((tower[i].y - mouseY) * (tower[i].y - mouseY))) < 15 && click == false) {
							drawTowerF(true, tower[i].x, tower[i].y, tower[i].b.n, tower[i].l);
						} else {
							drawTowerF(false, tower[i].x, tower[i].y, tower[i].b.n, tower[i].l);
						}
					}
					if (tower[i].s == "g") {
						drawTowerG(tower[i].x, tower[i].y);
					}
					if (tower[i].s == "h") {
						drawTowerH(tower[i].x, tower[i].y, tower[i].l);
					}
					if (tower[i].s == "a" || tower[i].s == "b" || tower[i].s == "c" || tower[i].s == "e" || tower[i].s == "f" || tower[i].s == "g" || tower[i].s == "h") {
						ctx.beginPath();
						ctx.textBaseline = "middle";
						ctx.textAlign = "center";
						ctx.font = "10pt cursive";
						ctx.fillStyle = "rgb(0, 0, 0)";
						ctx.fillText(tower[i].l, tower[i].x, tower[i].y);
						ctx.closePath();
					}
				}
				for (var i = 0; i < missile.length; i++) {
					if (enemy.length > 0) {
						missile[i].move();
					}
				}
				for (var i = 0; i < grapeshot.length; i++) {
					if (enemy.length > 0) {
						grapeshot[i].move();
					}
				}
			}
		}
		function Enemy() {
			this.x = 0;
			this.y = 15;
			this.d = {x: 1, y: 0};
			this.i = 0;
			this.l = Math.floor(Math.sqrt(score * (1  / 100))) + 1;
			this.h = Math.floor(score * (1  / 10)) + 1;
			this.o = Math.floor(score * (1  / 10)) + 1;
			this.s = 1;
			this.m = [];
			this.move = function() {
				this.x = this.x + this.d.x * this.s;
				this.y = this.y + this.d.y * this.s;
				if (enemyPath[this.i].x - (this.s * 0.5) <= this.x && enemyPath[this.i].x + (this.s * 0.5) > this.x && enemyPath[this.i].y - (this.s * 0.5) <= this.y && enemyPath[this.i].y + (this.s * 0.5) > this.y) {
					this.i = this.i + 1;
					if (enemyPath[this.i].y < this.y) {
						this.d.x = 0;
						this.d.y = -1;
					} else if (enemyPath[this.i].x > this.x) {
						this.d.x = 1;
						this.d.y = 0;
					} else if (enemyPath[this.i].y > this.y) {
						this.d.x = 0;
						this.d.y = 1;
					} else if (enemyPath[this.i].x < this.x) {
						this.d.x = -1;
						this.d.y = 0;
					}
				}
			}
		}
		function enemyMove() {
			if (count % 30 == 0) {
				enemy.push(new Enemy());
			}
			for (var i = 0; i < enemy.length; i++) {
				enemy[i].move();
				for (var j = 0; j < enemy[i].m.length; j++) {
					enemy[i].h = enemy[i].h - (enemy[i].h * 0.000005);
					if (count - 450 > enemy[i].m[j]) {
						enemy[i].m.splice(j, 1);
					}
				}
				if(enemy[i].x > enemyPath[enemyPath.length - 1].x - 15 && enemy[i].x < enemyPath[enemyPath.length - 1].x + 15 && enemy[i].y > enemyPath[enemyPath.length - 1].y - 15 && enemy[i].y < enemyPath[enemyPath.length - 1].y + 15){
					drawEnemy(i, 0.5);
					enemy.splice(i, 1);
					health--;
					for (var j = 0; j < missile.length; j++) {
						if(missile[j].e == j) {
							missile.splice(j, 1);
						} else {
							missile[j].e = missile[j].e - 1;
						}
					}
				} else if (0 >= enemy[i].h) {
					money = money + Math.floor(enemy[i].l / 50) + 5;
					score = score + Math.floor(enemy[i].l);
					for (var j = missile.length - 1; j >= 0; j--) {
						if (enemy.length < missile.length) {
							missile.splice(j, 1);
						}
						if (missile[j].e > i) {
							missile[j].e = missile[j].e - 1;
						}
					}
					enemy.splice(i, 1);
				} else {
					drawEnemy(i);
				}
			}
		}
		function drawMenu() {
			var canvas = document.getElementById("game");
			if (canvas.getContext) {
				var ctx = canvas.getContext("2d");
				ctx.fillStyle = "rgb(0, 0, 0)";
				ctx.fillRect(541, 1, 178, 538);
				ctx.beginPath();
				ctx.strokeStyle = "rgb(255, 255, 255)";
				ctx.moveTo(540, 0);
				ctx.lineTo(540, 540);
				ctx.stroke();
				ctx.closePath();
				ctx.font = "18pt cursive";
				ctx.textBaseline = "top";
				ctx.textAlign = "left";
				ctx.fillStyle = "rgb(255, 255, 255)";
				ctx.fillText("Score:", 550, 10);
				ctx.fillText("Money:", 550, 45);
				ctx.fillText("Health:", 550, 80);
				ctx.textAlign = "right";
				ctx.fillText(score, 710, 10);
				ctx.fillText(money, 710, 45);
				ctx.fillText(health, 710, 80);
				drawTowerA(false, 570, 510, 1);
				drawHint(570, 510, "a");
				drawTowerB(false, 610, 510, 1);
				drawHint(610, 510, "b");
				drawTowerC(false, 650, 510, 1);
				drawHint(650, 510, "c");
				drawTowerD(690, 510, 0);
				drawHint(690, 510, "d");
				drawTowerE(false, 570, 470, 0);
				drawHint(570, 470, "e");
				drawTowerF(false, 610, 470, 0, 1);
				drawHint(610, 470, "f");
				drawTowerG(650, 470);
				drawHint(650, 470, "g");
				drawTowerH(690, 470);
				drawHint(690, 470, "h");
			}
		}
		function drawHint(x, y, s) {
			var canvas = document.getElementById("game");
			if (canvas.getContext) {
				var ctx = canvas.getContext("2d");
				if (Math.sqrt(((x - mouseX) * (x - mouseX)) + ((y - mouseY) * (y - mouseY))) < 15) {
					ctx.font = "12pt cursive";
					ctx.textBaseline = "top";
					ctx.textAlign = "left";
					ctx.fillStyle = "rgb(255, 255, 255)";
					for (var k = 0; k < 7; k++) {
						ctx.beginPath();
						if (s == "a") {
							ctx.strokeStyle = "rgba(255, " + (100 + (k * 20)) + ", 0, " + (1 - k / 6) + ")";
						} else if (s == "b") {
							ctx.strokeStyle = "rgba(0, " + (100 + k * 20) + ", 255, " + (1 - k / 6) + ")";
						} else if (s == "c") {
							ctx.strokeStyle = "rgba(" + (75 + (k * 20)) + ", 120, 255, " + (1 - k / 6) + ")";
						} else if (s == "d") {
							ctx.strokeStyle = "rgba(255, " + (k * 20) + ", 0, " + (1 - k / 6) + ")";
						} else if (s == "e") {
							ctx.strokeStyle = "rgba(" + (100 + k * 30) + ", " + (255 - k * 10) + ", " + (255 - k * 10) + ", " + (1 - k / 6) + ")";
						} else if (s == "f") {
							ctx.strokeStyle = "rgba(" + (k * 20) + ", " + (120 + k * 20) + ", 0, " + (1 - k / 6) + ")";
						} else if (s == "g") {
							ctx.strokeStyle = "rgba(" + (130 + k * 20) + ", " + (130 + k * 20) + ", 75, " + (1 - k / 6) + ")";
						} else if (s == "h") {
							ctx.strokeStyle = "rgba(" + (90 + k * 20) + ", 0, " + (90 + k * 20) + ", " + (1 - k / 6) + ")";
						}
						ctx.moveTo(560, 168 + k);
						ctx.lineTo(700, 168 + k);
						ctx.arc(700, 180, 12 - k, 270 * Math.PI / 180, 0, false);
						ctx.lineTo(712 - k, 428);
						ctx.arc(700, 428, 12 - k, 0, 90 * Math.PI / 180, false);
						ctx.lineTo(563, 440 - k);
						ctx.arc(560, 428, 12 - k, 90 * Math.PI / 180, Math.PI, false);
						ctx.lineTo(548 + k, 180);
						ctx.arc(560, 180, 12 - k, Math.PI, 270 * Math.PI / 180, false);
						ctx.stroke();
						ctx.closePath();
					}
				}
			}
		}
		function drawTowerA(click, x, y ,l) {
			var canvas = document.getElementById("game");
			if (canvas.getContext) {
				var ctx = canvas.getContext("2d");
				if (click == true) {
					ctx.beginPath();
					ctx.fillStyle = "rgba(255, 150, 0, 0.1)";
					if (l <= 5) {
						ctx.arc(x, y, 45 + l * 15, 0, Math.PI*2, true);
					} else {
						ctx.arc(x, y, 120, 0, Math.PI*2, true);
					}
					ctx.fill();
					ctx.closePath();
				}
				for (var k = 0; k < 12; k++) {
					ctx.beginPath();
					ctx.arc(x, y, 13 - k, 0, Math.PI*2, true);
					ctx.fillStyle = "rgb(255, " + (100 + (k * 10)) + ", 0)";
					ctx.fill();
					ctx.closePath();
				}
			}
		}
		function drawTowerB(click, x, y, l) {
			var canvas = document.getElementById("game");
			if (canvas.getContext) {
				var ctx = canvas.getContext("2d");
				if (click == true) {
					ctx.beginPath();
					ctx.fillStyle = "rgba(0, 150, 255, 0.1)";
					if (l <= 5) {
						ctx.arc(x, y, 30 + l * 45, 0, Math.PI*2, true);
					} else {
						ctx.arc(x, y, 255, 0, Math.PI*2, true);
					}
					ctx.fill();
					ctx.closePath();
				}
				for (var k = 0; k < 12; k++) {
					ctx.beginPath();
					ctx.arc(x, y, 13 - k, 0, Math.PI*2, true);
					ctx.fillStyle = "rgb(0, " + (100 + k * 10) + ", 255)";
					ctx.fill();
					ctx.closePath();
				}
			}
		}
		function drawTowerC(click, x, y, l) {
			var canvas = document.getElementById("game");
			if (canvas.getContext) {
				var ctx = canvas.getContext("2d");
				if (click == true) {
					ctx.beginPath();
					ctx.fillStyle = "rgba(190, 120, 255, 0.1)";
					ctx.arc(x, y, 45, 0, Math.PI*2, true);
					ctx.fill();
					ctx.closePath();
				}
				for (var k = 0; k < 12; k++) {
					ctx.beginPath();
					ctx.arc(x, y, 13 - k, 0, Math.PI*2, true);
					ctx.fillStyle = "rgb(" + (75 + (k * 10)) + ", 120, 255)";
					ctx.fill();
					ctx.closePath();
				}
			}
		}
		function drawTowerD(x, y, b) {
			var canvas = document.getElementById("game");
			if (canvas.getContext) {
				var ctx = canvas.getContext("2d");
				for (var k = 0; k < 12 + b; k++) {
					ctx.beginPath();
					ctx.arc(x, y, 13 - k + b, 0, Math.PI*2, true);
					ctx.fillStyle = "rgba(255, " + (k * 10) + ", 0, " + (1 - (b * (1 / 30))) + ")";
					ctx.fill();
					ctx.closePath();
				}
			}
		}
		function drawTowerE(click, x, y, b) {
			var canvas = document.getElementById("game");
			if (canvas.getContext) {
				var ctx = canvas.getContext("2d");
				if (click == true) {
					ctx.beginPath();
					ctx.fillStyle = "rgba(100, 178, 255, 0.1)";
					ctx.arc(x, y, 45, 0, Math.PI*2, true);
					ctx.fill();
					ctx.closePath();
				}
				for (var k = 0; k < 12; k++) {
					ctx.beginPath();
					ctx.arc(x, y, 13 - k, 0, Math.PI*2, true);
					ctx.fillStyle = "rgb(" + (100 + k * 15) + ", " + (255 - k * 5) + ", " + (255 - k * 5) + ")";
					ctx.fill();
					ctx.closePath();
				}
				if (b > 0) {
					ctx.beginPath();
					ctx.fillStyle = "rgba(145, 240, 240, " + (0.3 - (b * 0.005)) + ")";
					ctx.arc(x, y, 15 + (b * 0.5), 0, Math.PI*2, true);
					ctx.fill();
					ctx.closePath();
					ctx.beginPath();
					ctx.strokeStyle = "rgba(145, 240, 240, " + (1 - (b * 0.01)) + ")";
					ctx.arc(x, y, 15 + (b * 0.5), 0, Math.PI*2, true);
					ctx.stroke();
					ctx.closePath();
				}
			}
		}
		function drawTowerF(click, x, y, b, l) {
			var canvas = document.getElementById("game");
			if (canvas.getContext) {
				var ctx = canvas.getContext("2d");
				if (click == true) {
					ctx.beginPath();
					ctx.fillStyle = "rgba(60, 180, 0, 0.1)";
					if (l <= 5) {
						ctx.arc(x, y, 30 + l * 15, 0, Math.PI*2, true);
					} else {
						ctx.arc(x, y, 105, 0, Math.PI*2, true);
					}
					ctx.fill();
					ctx.closePath();
				}
				for (var k = 0; k < 12; k++) {
					ctx.beginPath();
					ctx.arc(x, y, 13 - k, 0, Math.PI*2, true);
					ctx.fillStyle = "rgb(" + (k * 10) + ", " + (120 + k * 10) + ", 0)";
					ctx.fill();
					ctx.closePath();
				}
				if (b > 0) {
					ctx.beginPath();
					if (l <= 5) {
						ctx.fillStyle = "rgba(60, 180, 0, " + (0.3 - (b * 0.3 / (30 + l * 30))) + ")";
						ctx.strokeStyle = "rgba(60, 180, 0, " + (1 - (b * 0.6 / (30 + l * 30))) + ")";
					} else {
						ctx.fillStyle = "rgba(60, 180, 0, " + (0.3 - (b * 0.3 / 180)) + ")";
						ctx.strokeStyle = "rgba(60, 180, 0, " + (1 - (b * 0.6 / 180)) + ")";
					}
					ctx.arc(x, y, 15 + (b * 0.5), 0, Math.PI*2, true);
					ctx.fill();
					ctx.stroke();
					ctx.closePath();
				}
			}
		}
		function drawTowerG(x, y) {
			var canvas = document.getElementById("game");
			if (canvas.getContext) {
				var ctx = canvas.getContext("2d");
				for (var k = 0; k < 12; k++) {
					ctx.beginPath();
					ctx.arc(x, y, 13 - k, 0, Math.PI*2, true);
					ctx.fillStyle = "rgb(" + (130 + k * 10) + ", " + (130 + k * 10) + ", 75)";
					ctx.fill();
					ctx.closePath();
				}
			}
		}
		function drawTowerH(x, y) {
			var canvas = document.getElementById("game");
			if (canvas.getContext) {
				var ctx = canvas.getContext("2d");
				for (var k = 0; k < 12; k++) {
					ctx.beginPath();
					ctx.arc(x, y, 13 - k, 0, Math.PI*2, true);
					ctx.fillStyle = "rgb(" + (90 + k * 10) + ", 0, " + (90 + k * 10) + ")";
					ctx.fill();
					ctx.closePath();
				}
			}
		}
		function drawMissile(x, y, dx, dy) {
			var canvas = document.getElementById("game");
			if (canvas.getContext) {
				var ctx = canvas.getContext("2d");
				ctx.beginPath();
				ctx.strokeStyle = "rgb(255, 0, 0)";
				ctx.moveTo(x + (dx * 3.25), y + (dy * 3.25));
				ctx.lineTo(x + (dx * 2), y - (dy * 2));
				ctx.lineTo(x - (dx * 2), y + (dy * 2));
				ctx.lineTo(x + (dx * 3.25), y + (dy * 3.25));
				ctx.stroke();
				ctx.closePath();
				ctx.beginPath();
				ctx.fillStyle = "rgb(255, 0, 0)";
				ctx.arc(x, y, 2, 0, Math.PI*2, true);
				ctx.fill();
				ctx.closePath();
			}
		}
		function drawEnemy(i) {
			var canvas = document.getElementById("game");
			if (canvas.getContext) {
				var ctx = canvas.getContext("2d");
				ctx.fillStyle = "rgb(255, 255, 255)";
				ctx.strokeStyle = "rgb(0, 0, 0)";
				ctx.fillRect(enemy[i].x - 5, enemy[i].y - 5, 10, 10);
				ctx.strokeRect(enemy[i].x - 6, enemy[i].y - 6, 12, 12);
				if (enemy[i].m.length > 0) {
					ctx.fillStyle = "rgba(60, 180, 0, 0.5)";
					ctx.fillRect(enemy[i].x - 5, enemy[i].y - 5, 10, 10);
				}
				if (enemy[i].s == 0.5) {
					ctx.strokeStyle = "rgb(100, 178, 255)";
					ctx.strokeRect(enemy[i].x - 5, enemy[i].y - 5, 10, 10);
					ctx.strokeRect(enemy[i].x - 4, enemy[i].y - 4, 8, 8);
				}
				ctx.fillStyle = "rgb(82, 255, 82)";
				ctx.fillRect(enemy[i].x - 7, enemy[i].y + 6, enemy[i].h / enemy[i].o * 14, 2);
			}
		}
		function onMouseDown() {
			var canvas = document.getElementById("game");
			if (canvas.getContext) {
				var ctx = canvas.getContext("2d");
				if (mouseX < 540 && mouseY < 540 && mouseX >= 0 && mouseY >= 0 && (Math.floor(mouseX / 30) != 0 || Math.floor(mouseY / 30) != 0)) {
					if (map[Math.floor(mouseX / 30)][Math.floor(mouseY / 30)] == "tower") {
						for (var i = 0; i < tower.length; i++) {
							if (Math.sqrt(((tower[i].x - mouseX) * (tower[i].x - mouseX)) + ((tower[i].y - mouseY) * (tower[i].y - mouseY))) < 15 && money >= 10 && click == false) {
								if (tower[i].s == "e" || tower[i].s == "f") {
									if (tower[i].l < 60) {
										tower[i].l = tower[i].l + 1;
										money = money - 10;
									}
								} else {
									tower[i].l = tower[i].l + 1;
									money = money - 10;
								}
							}
						}
					}
				}
			}
			if (Math.sqrt(((570 - mouseX) * (570 - mouseX)) + ((510 - mouseY) * (510 - mouseY))) < 15) {
				click = "a";
			} else if (Math.sqrt(((610 - mouseX) * (610 - mouseX)) + ((510 - mouseY) * (510 - mouseY))) < 15) {
				click = "b";
			} else if (Math.sqrt(((650 - mouseX) * (650 - mouseX)) + ((510 - mouseY) * (510 - mouseY))) < 15) {
				click = "c";
			} else if (Math.sqrt(((690 - mouseX) * (690 - mouseX)) + ((510 - mouseY) * (510 - mouseY))) < 15) {
				click = "d";
			} else if (Math.sqrt(((570 - mouseX) * (570 - mouseX)) + ((470 - mouseY) * (470 - mouseY))) < 15) {
				click = "e";
			} else if (Math.sqrt(((610 - mouseX) * (610 - mouseX)) + ((470 - mouseY) * (470 - mouseY))) < 15) {
				click = "f";
			} else if (Math.sqrt(((650 - mouseX) * (650 - mouseX)) + ((470 - mouseY) * (470 - mouseY))) < 15) {
				click = "g";
			} else if (Math.sqrt(((690 - mouseX) * (690 - mouseX)) + ((470 - mouseY) * (470 - mouseY))) < 15) {
				click = "h";
			}
		}
		function onMouseUp() {
			var canvas = document.getElementById("game");
			if (canvas.getContext) {
				var ctx = canvas.getContext("2d");
				if (mouseX < 540 && mouseY < 540 && mouseX >= 0 && mouseY >= 0 && (Math.floor(mouseX / 30) != 0 || Math.floor(mouseY / 30) != 0)) {
					if (map[Math.floor(mouseX / 30)][Math.floor(mouseY / 30)] == "unTower" && money >= 50 && click == "a") {
						map[Math.floor(mouseX / 30)][Math.floor(mouseY / 30)] = "tower";
						tower.push({
							s: "a",
							l: 1,
							x: Math.floor(mouseX / 30) * 30 + 15,
							y: Math.floor(mouseY / 30) * 30 + 15,
							c: count,
							action: function(){
								for (var k = 0; k < enemy.length; k++) {
									if ((this.l <= 5 && Math.sqrt(((enemy[k].x - this.x) * (enemy[k].x - this.x)) + ((enemy[k].y - this.y) * (enemy[k].y - this.y))) < 45 + this.l * 15) || (this.l > 5 && Math.sqrt(((enemy[k].x - this.x) * (enemy[k].x - this.x)) + ((enemy[k].y - this.y) * (enemy[k].y - this.y))) < 120)) {
										ctx.beginPath();
										ctx.strokeStyle = "rgb(255, 0, 0)";
										ctx.moveTo(this.x, this.y);
										ctx.lineTo(enemy[k].x, enemy[k].y);
										ctx.stroke();
										ctx.closePath();
										enemy[k].h = enemy[k].h - (this.l / 250);
										break;
									}
								}
							}
						});
						money = money - 50;
					}
					if (map[Math.floor(mouseX / 30)][Math.floor(mouseY / 30)] == "unTower" && money >= 50 && click == "b"){
						map[Math.floor(mouseX / 30)][Math.floor(mouseY / 30)] = "tower";
						tower.push({
							s: "b",
							l: 1,
							x: Math.floor(mouseX / 30) * 30 + 15,
							y: Math.floor(mouseY / 30) * 30 + 15,
							c: count,
							action: function(){
								if ((count - this.c) % 60 == 0) {
									for (var k = 0; k < enemy.length; k++) {
										if ((this.l <= 5 && Math.sqrt(((enemy[k].x - this.x) * (enemy[k].x - this.x)) + ((enemy[k].y - this.y) * (enemy[k].y - this.y))) < 30 + this.l * 45) || (this.l > 5 && Math.sqrt(((enemy[k].x - this.x) * (enemy[k].x - this.x)) + ((enemy[k].y - this.y) * (enemy[k].y - this.y))) < 255)) {
												missile.push({
												x: this.x,
												y: this.y,
												l: this.l,
												d: {x: 0, y: 0},
												e: k,
												move: function(){
													this.d.x = (enemy[k].x - this.x) * (1 / (Math.abs(enemy[k].x - this.x) + Math.abs(enemy[k].y - this.y)));
													this.d.y = (enemy[k].y - this.y) * (1 / (Math.abs(enemy[k].x - this.x) + Math.abs(enemy[k].y - this.y)));
													if (this.d.x > 0) {
														this.x = this.x + Math.sqrt(this.d.x) * 1.25;
													} else {
														this.x = this.x - Math.sqrt(Math.abs(this.d.x)) * 1.25;
													}
													if (this.d.y > 0) {
														this.y = this.y + Math.sqrt(this.d.y) * 1.25;
													} else {
														this.y = this.y - Math.sqrt(Math.abs(this.d.y)) * 1.25;
													}
													drawMissile(this.x, this.y, this.d.x, this.d.y);
													if (this.x > enemy[k].x - 5 && this.x < enemy[k].x + 5 && this.y > enemy[k].y - 5 && this.y < enemy[k].y + 5) {
														enemy[k].h = enemy[k].h - this.l;
														missile.splice(missile.indexOf(this, 0), 1);
													}
												}
											});
											break;
										}
									}
								}
							}
						});
						money = money - 50;
					}
					if (map[Math.floor(mouseX / 30)][Math.floor(mouseY / 30)] == "unTower" && money >= 50 && click == "c"){
						map[Math.floor(mouseX / 30)][Math.floor(mouseY / 30)] = "tower";
						tower.push({
							s: "c",
							l: 1,
							x: Math.floor(mouseX / 30) * 30 + 15,
							y: Math.floor(mouseY / 30) * 30 + 15,
							c: count,
							action: function(){
								for (var k = 0; k < enemy.length; k++) {
									if (Math.sqrt(((enemy[k].x - this.x) * (enemy[k].x - this.x)) + ((enemy[k].y - this.y) * (enemy[k].y - this.y))) < 45) {
										ctx.beginPath();
										ctx.strokeStyle = "rgb(255, 0, 0)";
										ctx.moveTo(this.x, this.y);
										ctx.lineTo(enemy[k].x, enemy[k].y);
										ctx.stroke();
										ctx.closePath();
										enemy[k].h = enemy[k].h - (this.l / 300);
									}
								}
							}
						});
						money = money - 50;
					}
					if (map[Math.floor(mouseX / 30)][Math.floor(mouseY / 30)] == "unTower" && money >= 50 && click == "d"){
						map[Math.floor(mouseX / 30)][Math.floor(mouseY / 30)] = "tower";
						tower.push({
							s: "d",
							b: 0,
							x: Math.floor(mouseX / 30) * 30 + 15,
							y: Math.floor(mouseY / 30) * 30 + 15,
							c: count,
							action: function(){
								if (this.b <= 30) {
									this.b = this.b + 1;
									for (var k = 0; k < enemy.length; k++) {
										if (Math.sqrt(((enemy[k].x - this.x) * (enemy[k].x - this.x)) + ((enemy[k].y - this.y) * (enemy[k].y - this.y))) < 15 + this.b) {
											enemy[k].h = 0;
										}
									}
								} else {
									map[(this.x - 15) / 30][(this.y - 15) / 30] = "unTower";
									tower.splice(tower.indexOf(this, 0), 1);
								}
							}
						});
						money = money - 50;
					}
					if (map[Math.floor(mouseX / 30)][Math.floor(mouseY / 30)] == "unTower" && money >= 50 && click == "e"){
						map[Math.floor(mouseX / 30)][Math.floor(mouseY / 30)] = "tower";
						tower.push({
							s: "e",
							b: {f: false, n:0},
							l: 1,
							x: Math.floor(mouseX / 30) * 30 + 15,
							y: Math.floor(mouseY / 30) * 30 + 15,
							c: count,
							action: function(){
								if ((count - this.c) % (900 - this.l * 10) == 0) {
									this.b.f = true;
								}
								if (this.b.f == true) {
									this.b.n = this.b.n + 1;
									for (var k = 0; k < enemy.length; k++) {
										if (Math.sqrt(((enemy[k].x - this.x) * (enemy[k].x - this.x)) + ((enemy[k].y - this.y) * (enemy[k].y - this.y))) < 15 + (this.b.n * 0.5)) {
											enemy[k].s = 0.5;
										}
									}
									if (this.b.n == 60) {
										this.b.n = 0;
										this.b.f = false;
									}
								}
							}
						});
						money = money - 50;
					}
					if (map[Math.floor(mouseX / 30)][Math.floor(mouseY / 30)] == "unTower" && money >= 50 && click == "f"){
						map[Math.floor(mouseX / 30)][Math.floor(mouseY / 30)] = "tower";
						tower.push({
							s: "f",
							b: {f: false, n:0},
							l: 1,
							x: Math.floor(mouseX / 30) * 30 + 15,
							y: Math.floor(mouseY / 30) * 30 + 15,
							c: count,
							action: function(){
								if ((count - this.c) % (1200 - this.l * 10) == 0) {
									this.b.f = true;
								}
								if (this.b.f == true) {
									this.b.n = this.b.n + 1;
									for (var k = 0; k < enemy.length; k++) {
										if (Math.sqrt(((enemy[k].x - this.x) * (enemy[k].x - this.x)) + ((enemy[k].y - this.y) * (enemy[k].y - this.y))) < 15 + (this.b.n * 0.5)) {
											enemy[k].m.push(count);
										}
									}
									if ((this.l <= 5 && this.b.n == 30 + this.l * 30) || (this.l > 5 && this.b.n == 180)) {
										this.b.n = 0;
										this.b.f = false;
									}
								}
							}
						});
						money = money - 50;
					}
					if (map[Math.floor(mouseX / 30)][Math.floor(mouseY / 30)] == "unTower" && money >= 50 && click == "g"){
						map[Math.floor(mouseX / 30)][Math.floor(mouseY / 30)] = "tower";
						tower.push({
							s: "g",
							l: 1,
							x: Math.floor(mouseX / 30) * 30 + 15,
							y: Math.floor(mouseY / 30) * 30 + 15,
							c: count,
							action: function(){
								if ((count - this.c) % 240 == 0) {
									for (var i = -1; i <= 1; i += 0.5) {
										for (var j = -1; j <= 1; j += 0.5) {
											if (Math.abs(i) + Math.abs(j) == 1) {
												grapeshot.push({
												x: this.x,
												y: this.y,
												l: this.l,
												d: {x: i, y: j},
												move: function(){
													if (this.d.x > 0) {
														this.x = this.x + Math.sqrt(this.d.x) * 2;
													} else {
														this.x = this.x - Math.sqrt(Math.abs(this.d.x)) * 2;
													}
													if (this.d.y > 0) {
														this.y = this.y + Math.sqrt(this.d.y) * 2;
													} else {
														this.y = this.y - Math.sqrt(Math.abs(this.d.y)) * 2;
													}
													ctx.beginPath();
													ctx.fillStyle = "rgb(190, 190, 75)";
													ctx.arc(this.x, this.y, 2, 0, Math.PI*2, true);
													ctx.fill();
													ctx.closePath();
													for (var k = 0; k < enemy.length; k++) {
														if (this.x > enemy[k].x - 5 && this.x < enemy[k].x + 5 && this.y > enemy[k].y - 5 && this.y < enemy[k].y + 5) {
															enemy[k].h = enemy[k].h - this.l;
															grapeshot.splice(grapeshot.indexOf(this, 0), 1);
														}
													}
													if (this.x > 540 || this.y > 540 || this.x < 0 || this.y < 0 ) {
														grapeshot.splice(grapeshot.indexOf(this, 0), 1);
													}
												}
												});
											}
										}
									}
								}
							}
						});
						money = money - 50;
					}
					if (map[Math.floor(mouseX / 30)][Math.floor(mouseY / 30)] == "unTower" && money >= 50 && click == "h"){
						map[Math.floor(mouseX / 30)][Math.floor(mouseY / 30)] = "tower";
						tower.push({
							s: "h",
							l: 1,
							x: Math.floor(mouseX / 30) * 30 + 15,
							y: Math.floor(mouseY / 30) * 30 + 15,
							c: count,
							action: function(){
								for (var k = 0; k < enemy.length; k++) {
									if ((this.l <= 5 && Math.sqrt(((enemy[k].x - this.x) * (enemy[k].x - this.x)) + ((enemy[k].y - this.y) * (enemy[k].y - this.y))) < 45 + this.l * 15) || (this.l > 5 && Math.sqrt(((enemy[k].x - this.x) * (enemy[k].x - this.x)) + ((enemy[k].y - this.y) * (enemy[k].y - this.y))) < 120)) {
										ctx.beginPath();
										ctx.strokeStyle = "rgb(255, 0, 0)";
										ctx.moveTo(this.x, this.y);
										ctx.lineTo(enemy[k].x, enemy[k].y);
										ctx.stroke();
										ctx.closePath();
										enemy[k].h = enemy[k].h - (this.l / 2500);
										break;
									}
								}

							}
						});
						money = money - 50;
					}
				}
				click = false;
			}
		}
		var intervalID = setInterval(draw,1000 / 60);
		$("body").on("mousedown",onMouseDown);
		$("body").on("mouseup",onMouseUp);
	</script>
	<script src="main.js"></script>
</body>
</html>
